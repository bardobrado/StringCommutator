<button onclick="backText();">back</button>
<p id="demo">Funciona melhor com textos menores.</p>
<button onclick="nextText();">next</button>
<script>
import { onMount } from "svelte";

let origin = "Funciona melhor com textos menores.";
let final = "Mas ainda assim Ã© um efeito legal";
let part;
let k = 0;
let rnd;
let rndList = [];
let speed = 5;
let element = "demo";
let running = false;

part = document.getElementById(element).innerHTML;


function setK( k) {
	k = k;
}

function getK() {
	return k;
}

function isRunning() {
    return running;
}
function setRunning( bol)
{
    running = bol;
}

function genRnd( mod ) {
    return Math.random() * mod;
}

function getRnd() {
    return rnd;
}

function setRnd( rd ) {
    rnd = rd;
} 

function getSpeed() {
    return speed;
}
function setSpeed(spd) {
    speed = spd;
}

function getFinal() {
    return final;
}

function setFinal (fin) {
    final = fin;
}

function getOrigin() {
    return origin;
}

function setOrigin(ori) {
    origin = ori;
}

function getDocElement() {
    return element;
}

function setDocElement(elem) {
    element = elem;
}

function getDocElemInner(){
    return part;
}

function setDocElemInner(docElem) {
    part = docElem
}

function nextText() {
	if (getFinal().length >= getOrigin().length) {
		if (getDocElemInner() != GetFinal()) {
			setRunning(true);
			document.getElementById(getDocElem()).innerHTML =
				randSliceReplaceNext(getDocElemInner(), getFinal());

			setTimeout(nextText, getSpeed());
		} else {
			rndList = [];
			setK(0);
			setDocElemInner(getFinal());
			setRunning(false);
		}
	} else {
		if (getDocElemInner().slice(0, getFinal().length) != getFinal()) {
			setRunning(true);
			document.getElementById(getDocElement()).innerHTML =
				randSliceReplaceNext(getDocElemInner(), getFinal());
			setTimeout(nextText, getSpeed());
		} else {
			rndList = [];
			setK(0);
			nextTextDesc();
			setDocElemInner(getFinal());
			setRunning(false);
		}
	}
}

function nextTextDesc() {
	document.getElementById(getDocElement()).innerHTML = removeExcedent(
		getOrigin(),
		getFinal(),
		getK()	
	);
	setTimeout(nextTextDesc, getSpeed());
}

function removeExcedent(origin, final, kj) {
	if (getK() < origin.length - final.length) {
		setDocElemInner(getDocElemInner().slice(0, final.length) + getDocElemInner().slice(final.length, origin.length - getK()));
		kj++;
		setK(kj);

	}
	return getDocElemInner();
}

function randSliceReplaceNext(origin, final, k) {
	setRnd(genRnd(final.length));

	if (rndList.includes(getRnd())) {
		return randSliceReplaceNext(origin, final);
	} else {
		rndList.concat(getRnd());
		setK(getK()+1);
	}
	setDocElemInner(origin.slice(0, getRnd()));
	setDocElemInner(getDocElemInner()+final.charAt(getRnd()) + origin.slice(getRnd() + 1));
	
	return getDocElemInner();
}

function backText() {
	if (getOrigin().length >= getFinal().length) {
		if ( getK() < getOrigin().length && getDocElemInner() != getOrigin()) {
			setRunning(true);
			document.getElementById(getDocElement()).innerHTML =
				randSliceReplaceNext(getDocElemInner(), getOrigin(), getK());
			
			setTimeout(backText, getSpeed());
		} else {
			rndList = [];
			setK(0);
			setDocElemInner(getOrigin());
			setRunning(false);
		}
	} else {
		if (getDocElemInner().slice(0, getOrigin().length) != getOrigin()) {
			setRunning(true);
			document.getElementById(getDocElem()).innerHTML =
				randSliceReplaceNext(getDocElemInner(), getOrigin());
			setTimeout(backText, getSpeed());
		} else {
			setK(0);
			rndList = [];
			backTextDesc();
			setDocElemInner(getFinal());
			setRunning(false);
		}
	}
}

function backTextDesc() {
	document.getElementById(getDocElem()).innerHTML = removeExcedent(
		getFinal(),
		getOrigin(),
		getK()
	);
	setTimeout(backTextDesc, getSpeed());
}
</script>
